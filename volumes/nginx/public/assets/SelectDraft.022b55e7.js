import{Q as ve}from"./QSpace.25e12c99.js";import{a as v}from"./QBtn.5c02f783.js";import{d as De,e as f}from"./QTable.aeae091e.js";import{Q as ye,b as he}from"./QCard.b3936020.js";import{c as D}from"./config.7e38babc.js";import{a as y}from"./index.2cf0d985.js";import{_ as be}from"./DeleteDialog.258cb81c.js";import{_ as ke}from"./CompleteDialog.b8079208.js";import{u as we,r as Fe,p as Ne,o as Se,w as b,t as _,x as g,d as s,y as i,m as Te,E as Ie,H as k,q as p,B as w,G as Ce,A as h,I as Re}from"./index.f310304c.js";import"./render.ce2d7a1b.js";import"./QMenu.b1f28aa8.js";import"./position-engine.e8f4f385.js";import"./selection.b35dc685.js";import"./use-key-composition.d2263223.js";import"./create-uploader-component.d0353082.js";import"./format.3e32b8d9.js";import"./uid.42677368.js";import"./use-form.8230d3f4.js";import"./option-sizes.4546a983.js";const Ue={class:"col-12 q-layout-padding flex justify-center content-center"},Pe={class:"col-sm-10 offset-sm-1 text-center"},xe={class:"q-table__title text-weight-bolder"},Oe=w("\u4E00\u6642\u4FDD\u5B58\u30C7\u30FC\u30BF\u4E00\u89A7"),qe={key:0},Ee={key:1},Ae={key:2},at={setup(Qe){const u=we(),F=Te();var c=[];const m=Fe([]),r=Ne({columns:[{name:"fileName",align:"left",label:"\u30D5\u30A1\u30A4\u30EB\u540D",sortable:!0,field:"fileName"},{name:"ckanInfo",align:"left",label:"\u767B\u9332\u5148CKAN",sortable:!0,field:"ckanInfo"},{name:"saved",align:"left",label:"\u4FDD\u5B58\u65E5",sortable:!0,field:"saved"},{name:"restart",align:"left",field:"restart"},{name:"delete",align:"left",field:"delete"}],tableData:[],noSelectedCatalog:!0,deleteDialog:{pageName:"",isDisplay:!1,catalogName:""},completeDialog:{isDisplay:!1,message:"",errorFlg:!1}});Se(function(){console.log("-- SelectDraft.vue onMounted --"),y.get(D.apiPrefix+"/temporal").then(async e=>{c=e.data,c.sort((n,d)=>d.tmpFile.saved-n.tmpFile.saved);for(var l=0;l<c.length;l++){var t=c[l].tmpFile.saved,a=t.slice(0,4)+"/"+t.slice(4,6)+"/"+t.slice(6,8)+" "+t.slice(8,10)+":"+t.slice(10,12)+":"+t.slice(12,14),o={fileName:c[l].tmpFile.tmp_file_name,ckanInfo:c[l].tmpFile.ckan_info,saved:a};r.tableData.push(o)}}).catch(e=>{console.log("error message:",e.response.data.message),r.completeDialog.isDisplay=!0,r.completeDialog.message=e.response.data.message||`\u4E00\u6642\u4FDD\u5B58\u30C7\u30FC\u30BF\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,r.completeDialog.errorFlg=!0})});function N(e){u.updateDatasetinfo({catalogTitle:e.title,catalogDescription:e.notes,datasetDescriptionUrl:e.url,datasetIdForDetail:e.caddec_dataset_id_for_detail,registOrg:e.regist_org,publisherId:e.caddec_provider_id,publisher:e.publisher_name,publisherUri:e.publisher_uri,creator:e.creator_name,creatorUrl:e.creator_url,contactPoint:e.contact_name,contactPointUrl:e.contact_url,storeType:"state"})}function S(e){var l=[];if(e.length)for(var t=0;t<e.length;t++){var a=e[t].label||"",o=e[t].inputSupportResourceType||"",n=e[t].inputSupportUrl||"",d=e[t].inputSupportNgsiTenant||"",q=e[t].inputSupportNgsiServicePath||"",E=e[t].inputSupportIsRequestSuccess||!1,A=e[t].dataname||"",Q=e[t].resourceType,B=e[t].downloadUrl||"",$=e[t].explainurl||"",L=e[t].filename||"",M=e[t].description||"",V=e[t].size||"",K=e[t].columnName||"",z=e[t].mimetype||"",W=e[t].format||"",G={label:e[t].compressFormat.label||"",value:e[t].compressFormat.value||""},H=e[t].compressFormatOther||"",J={label:e[t].packageFormat.label||"",value:e[t].packageFormat.value||""},X=e[t].packageFormatOther||"",Y=e[t].schema||"",Z=e[t].schemaType||"",j=e[t].ngsiEntityType||"",ee=e[t].ngsiTenant||"",te=e[t].ngsiServicePath||"",re=e[t].ngsiDataModel||"",le=e[t].contractRequired,ae=e[t].connectRequired,oe=e[t].getResourceIDForProvenance||"",se=e[t].resourceIDForProvenance||"",ie=e[t].previousEventId||"",ne=e[t].urlForProvenance||"",ce=e[t].caddeUserId||"",pe=e[t].dataServiceTitle||"",ue=e[t].dataServiceEndpointUrl||"",me=e[t].dataServiceEndpointDescription||"",fe=e[t].license_title||"",_e=e[t].licenseurl||"",ge=e[t].issued||"",de=e[t].id||"";l.push({label:a,inputSupportResourceType:o,inputSupportUrl:n,inputSupportNgsiTenant:d,inputSupportNgsiServicePath:q,inputSupportIsRequestSuccess:E,dataName:A,resourceType:Q,downloadUrl:B,explainurl:$,filename:L,description:M,size:V,columnName:K,mimetype:z,format:W,compressFormat:G,compressFormatOther:H,packageFormat:J,packageFormatOther:X,schema:Y,schemaType:Z,ngsiEntityType:j,ngsiTenant:ee,ngsiServicePath:te,ngsiDataModel:re,contractRequired:le,connectRequired:ae,getResourceIDForProvenance:oe,resourceIDForProvenance:se,previousEventId:ie,urlForProvenance:ne,caddeUserId:ce,dataServiceTitle:pe,dataServiceEndpointUrl:ue,dataServiceEndpointDescription:me,licensetitle:fe,licenseurl:_e,issued:ge,id:de})}u.updateFiledataDetails({filedataDetails:l,storeType:"state"})}function T(e){u.updateDatasetOptionalInfoParameters({selectThemes:e.theme,selectTags:e.tags,vocabulary:e.vocabulary,term:e.term,selectLanguage:e.language,frequency:e.frequency,spatialUrl:e.spatial_url,spatialName:e.spatial_text,spatial:e.spatial,start:e.temporal_start,end:e.temporal_end,storeType:"state"})}function I(e){u.updateUserTerms({termName:e.license_title,termNameUrl:e.license_url,usrRight:e.rights,accessRights:e.access_rights,accessRightsUrl:e.access_rights_url,haspolicyUrl:e.haspolicy_url,provWasGeneratedByUrl:e.prov_was_generated_by_url,conformsTo:e.conforms_to,contractType:e.trading_policy_contract_type,secrecy:e.trading_policy_nda,useApplication:e.trading_policy_use_application,useApplicationOther:e.trading_policy_use_application_free,scopeOfDisclosure:e.scope_of_disclosure,scopeOfDisclosureOther:e.scope_of_disclosure_free,permissionResion:e.terms_of_use_permissible_region,permissionResionOther:e.terms_of_use_permissible_region_free,notices:e.terms_of_use_notices,personalData:e.privacy_policy_contains_personal_data,personalDataOther:e.privacy_policy_contains_personal_data_free,dataEffectivePeriodSelectTerms:e.data_effective_period_term,startDate:e.data_effective_period_start,endDate:e.data_effective_period_end,dataEffectivePeriodFreefield:e.data_effective_period_free,usageLicensePeriodSelectTerms:e.usage_license_period_term,deadline:e.usage_license_period_deadline,period:e.usage_license_period_period,unit:e.usage_license_period_unit,usageLicensePeriodFreefield:e.usage_license_period_free,fee:e.fee,salesInfoUrl:e.sales_info_url,priceRange:e.pricing_price_range,noticesOfPrice:e.pricing_notices_of_price,expressWarranty:e.warranty_express_warranty,expressWarrantyOther:e.warranty_express_warranty_free,leagalCompliance:e.warranty_legal_compliance,leagalComplianceOther:e.warranty_legal_compliance_free,storeType:"state"})}function C(e){u.updateCkanName({ckanDataName:e.ckan_data_name}),u.updateAutoSetValue({issued:e.issued,identifier:e.identifier,datasetUrl:e.dataset_url})}function R(e){for(var l="",t=0;t<c.length;t++)if(e.row.fileName===c[t].tmpFile.tmp_file_name){l=c[t];break}N(l.datasetinfo),S(l.datajacket),T(l.datasetoptionalinfo),I(l.userterms),C(l.dataForUpdate),F.push("/register").then(a=>{Re(a)||(console.log("editRow-------------------"),console.log(e.row.ckanInfo),u.updateMode({mode:e.row.ckanInfo,ckanType:"",isBothCatalog:!1}))})}function U(){r.deleteDialog.pageName="selectDraftSelectedDelete",r.deleteDialog.isDisplay=!0}function P(e){r.deleteDialog.pageName="selectDraftOneDelete",r.deleteDialog.isDisplay=!0,r.deleteDialog.catalogName=e.row.fileName}function x(e){var l=[];l.push(e),y.request({method:"delete",url:D.apiPrefix+"/temporal",data:l}).then(async t=>{var a=t.data.del_data;if(a.length)for(var o=0;o<r.tableData.length;o++)for(var n=0;n<a.length;n++)r.tableData[o].fileName===a[n]&&r.tableData.splice(o,1);m.value=[],r.deleteDialog.isDisplay=!1}).catch(t=>{console.log("error message:",t.response.data.message),r.completeDialog.isDisplay=!0,r.completeDialog.message=t.response.data.message||`\u4E00\u6642\u4FDD\u5B58\u30C7\u30FC\u30BF\u524A\u9664\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,r.completeDialog.errorFlg=!0})}function O(){var e=0,l=[];for(e=0;e<m.value.length;e++)l.push(m.value[e].fileName);y.request({method:"delete",url:D.apiPrefix+"/temporal",data:l}).then(async t=>{var a=t.data.del_data;if(a.length)for(var o=0;o<r.tableData.length;o++)for(var n=0;n<a.length;n++)r.tableData[o].fileName===a[n]&&r.tableData.splice(o,1);m.value=[],r.deleteDialog.isDisplay=!1}).catch(t=>{console.log("error message:",t.response.data.message),r.completeDialog.isDisplay=!0,r.completeDialog.message=t.response.data.message||`\u4E00\u6642\u4FDD\u5B58\u30C7\u30FC\u30BF\u524A\u9664\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,r.completeDialog.errorFlg=!0})}return b(()=>r.tableData,(e,l)=>{r.tableData=e}),b(()=>m.value,e=>{e.length?r.noSelectedCatalog=!1:r.noSelectedCatalog=!0}),(e,l)=>{const t=Ie("font");return _(),g("div",Ue,[s(ye,{class:"q-card-background-white",style:{width:"100%"}},{default:i(()=>[s(he,null,{default:i(()=>[k("div",Pe,[s(De,{columns:p(r).columns,rows:p(r).tableData,selected:m.value,"onUpdate:selected":l[1]||(l[1]=a=>m.value=a),selection:"multiple","row-key":"fileName",separator:"cell","no-data-label":"\u4E00\u6642\u4FDD\u5B58\u3055\u308C\u3066\u3044\u308B\u30C7\u30FC\u30BF\u304C\u3042\u308A\u307E\u305B\u3093",class:"temporarySavedDataTable"},{top:i(()=>[k("div",xe,[s(t,{size:"5",color:"#1d468f"},{default:i(()=>[Oe]),_:1})]),s(ve),s(v,{style:{width:"12%"},outline:"",color:"red",onClick:l[0]||(l[0]=a=>U()),disable:p(r).noSelectedCatalog,icon:"delete",label:"\u524A\u9664"},null,8,["disable"])]),"body-cell-saved":i(a=>[s(f,{key:"fileName",props:a,class:"btn-cell"},{default:i(()=>[w(Ce(a.row.saved),1)]),_:2},1032,["props"])]),"body-cell-ckanInfo":i(a=>[s(f,{key:"ckanInfo",props:a,class:"btn-cell"},{default:i(()=>[a.row.ckanInfo==="new_release_register"?(_(),g("span",qe,"\u6A2A\u65AD\u691C\u7D22\u7528CKAN")):h("",!0),a.row.ckanInfo==="new_detail_register"?(_(),g("span",Ee,"\u8A73\u7D30\u691C\u7D22\u7528CKAN")):h("",!0),a.row.ckanInfo==="new_both_register"?(_(),g("span",Ae,"\u6A2A\u65AD\u30FB\u8A73\u7D30\u691C\u7D22\u7528CKAN")):h("",!0)]),_:2},1032,["props"])]),"body-cell-restart":i(a=>[s(f,{class:"btn-cell"},{default:i(()=>[s(v,{outline:"",color:"secondary",class:"full-width",onClick:o=>R(a),label:"\u518D\u958B",icon:"edit",field:"restart"},null,8,["onClick"])]),_:2},1024)]),"body-cell-delete":i(a=>[s(f,{class:"btn-cell"},{default:i(()=>[s(v,{outline:"",color:"red",class:"full-width",onClick:o=>P(a),label:"\u524A\u9664",icon:"delete",field:"delete"},null,8,["onClick"])]),_:2},1024)]),_:1},8,["columns","rows","selected"])]),s(be,{dialogInfo:p(r).deleteDialog,onDeleteOneCatalogData:x,onDeleteSelectedCatalogData:O,onCloseDialog:l[2]||(l[2]=a=>p(r).deleteDialog.isDisplay=!1)},null,8,["dialogInfo"]),s(ke,{dialogInfo:p(r).completeDialog,onCloseDialog:l[3]||(l[3]=a=>(p(r).completeDialog.isDisplay=!1,p(r).deleteDialog.isDisplay=!1))},null,8,["dialogInfo"])]),_:1})]),_:1})])}}};export{at as default};
