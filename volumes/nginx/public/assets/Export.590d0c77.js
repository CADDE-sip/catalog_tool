import{Q as x}from"./QRadio.e324f745.js";import{a as b}from"./QBtn.5c02f783.js";import{Q as C,b as k}from"./QCard.b3936020.js";import{c as f}from"./config.7e38babc.js";import{a as m}from"./index.2cf0d985.js";import{_ as D}from"./CompleteDialog.b8079208.js";import{u as B,p as T,o as h,w as F,f as V,t as v,x as _,d as l,y,q as s,E as U,H as d,A as N,B as E}from"./index.f310304c.js";import"./option-sizes.4546a983.js";import"./use-form.8230d3f4.js";import"./render.ce2d7a1b.js";function w(i){setTimeout(()=>{window.URL.revokeObjectURL(i.href)},1e4),i.remove()}function I(i,c,e={}){const{mimeType:g,byteOrderMark:p,encoding:u}=typeof e=="string"?{mimeType:e}:e,a=u!==void 0?new TextEncoder(u).encode([c]):c,t=p!==void 0?[p,a]:[a],n=new Blob(t,{type:g||"application/octet-stream"}),o=document.createElement("a");o.href=window.URL.createObjectURL(n),o.setAttribute("download",i),typeof o.download=="undefined"&&o.setAttribute("target","_blank"),o.classList.add("hidden"),o.style.position="fixed",document.body.appendChild(o);try{return o.click(),w(o),!0}catch(r){return w(o),r}}const R={class:"col-6"},A={class:"col"},Q={class:"q-mb-md row items-center"},$={class:"col-4"},L=E("\u30A8\u30AF\u30B9\u30DD\u30FC\u30C8\u5BFE\u8C61CKAN"),j={class:"col-8 flex justify-start"},P={key:0},q={class:"flex justify-center content-center"},Y={setup(i){const c=B(),e=T({exportCkanType:"release",dialog:{isDisplay:!1,message:"",errorFlg:!1},downloadBtnDisable:!0});async function g(){var a={rows:0,start:1e3};m.post(f.apiPrefix+"/export/"+e.exportCkanType,a).then(async t=>{console.log(t),t.status===200?(e.dialog.isDisplay=!0,e.dialog.message="\u30A8\u30AF\u30B9\u30DD\u30FC\u30C8\u51E6\u7406\u3092\u958B\u59CB\u3057\u307E\u3057\u305F\u3002",e.dialog.errorFlg=!1):(e.dialog.isDisplay=!0,e.dialog.message="\u30A8\u30AF\u30B9\u30DD\u30FC\u30C8\u51E6\u7406\u3092\u958B\u59CB\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002",e.dialog.errorFlg=!0)}).catch(t=>{console.log("error message:",t.response.data.message),e.dialog.isDisplay=!0,e.dialog.message=t.response.data.message||`\u30A8\u30AF\u30B9\u30DD\u30FC\u30C8\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,e.dialog.errorFlg=!0})}async function p(){e.downloadBtnDisable=!0;try{const t=await m.get(f.apiPrefix+"/export/file/"+e.exportCkanType,{responseType:"blob"});var a=u(t.headers["content-disposition"]);I(a,t.data,"application/gzip")===!0?(e.downloadBtnDisable=!1,e.dialog.isDisplay=!0,e.dialog.message="\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F\u3002",e.dialog.errorFlg=!1):(e.downloadBtnDisable=!1,e.dialog.isDisplay=!0,e.dialog.message="\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9\u304C\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002",e.dialog.errorFlg=!0)}catch{e.downloadBtnDisable=!1,e.dialog.isDisplay=!0,e.dialog.message="\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9\u304C\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002",e.dialog.errorFlg=!0}}function u(a){const t=/filename\*=UTF-8''([\w%\-.]+)(?:; |$)/,n=/filename=(["']?)(.*?[^\\])\1(?:; |$)/;let o=null;if(t.test(a))o=decodeURIComponent(t.exec(a)[1]);else{const r=n.exec(a);r!=null&&r[2]&&(o=r[2])}return o}return h(function(){console.log("-- Export.vue onMounted --"),e.intervalId=setInterval(async function(){(await m.post(f.apiPrefix+"/export/status",{ckan_type:e.exportCkanType})).data.status==="available"?e.downloadBtnDisable=!1:e.downloadBtnDisable=!0},1e4)}),F(()=>e.exportCkanType,a=>{m.post(f.apiPrefix+"/export/status",{ckan_type:e.exportCkanType}).then(t=>{t.data.status==="available"?e.downloadBtnDisable=!1:e.downloadBtnDisable=!0})}),V(function(){console.log("-- Export.vue onBeforeUnmount --"),clearInterval(e.intervalId)}),(a,t)=>{const n=U("font");return v(),_("div",R,[l(C,{class:"q-card-background-white"},{default:y(()=>[l(k,null,{default:y(()=>[d("div",A,[d("div",Q,[d("div",$,[l(n,{size:"3",color:"#1d468f"},{default:y(()=>[L]),_:1})]),d("div",j,[l(x,{modelValue:s(e).exportCkanType,"onUpdate:modelValue":t[0]||(t[0]=o=>s(e).exportCkanType=o),val:"release",label:"\u6A2A\u65AD\u691C\u7D22\u7528CKAN",color:"light-blue-10"},null,8,["modelValue"]),s(c).loginInfo.detailCkanAddr?(v(),_("div",P,[l(x,{modelValue:s(e).exportCkanType,"onUpdate:modelValue":t[1]||(t[1]=o=>s(e).exportCkanType=o),val:"detail",label:"\u8A73\u7D30\u691C\u7D22\u7528CKAN",style:{"margin-left":"16px"},color:"light-blue-10"},null,8,["modelValue"])])):N("",!0)])]),d("div",q,[l(b,{label:"\u30A8\u30AF\u30B9\u30DD\u30FC\u30C8",color:"primary",onClick:t[2]||(t[2]=o=>g())}),l(b,{label:"\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9",color:"primary",onClick:t[3]||(t[3]=o=>p()),disable:s(e).downloadBtnDisable,style:{"margin-left":"15px"}},null,8,["disable"])])])]),_:1})]),_:1}),l(D,{dialogInfo:s(e).dialog,onCloseDialog:t[4]||(t[4]=o=>s(e).dialog.isDisplay=!1)},null,8,["dialogInfo"])])}}};export{Y as default};
