import{Q as u}from"./QRadio.e324f745.js";import{f as A,a as g}from"./QBtn.5c02f783.js";import{c as D}from"./render.ce2d7a1b.js";import{a as T,af as q,r as C,u as w,p as N,t as c,x as v,d as t,y as r,q as s,E as z,H as a,A as m,z as _,G as y,B as d}from"./index.f310304c.js";import{a as I,Q as k}from"./QUploader.7f79e737.js";import{Q as B,b as S}from"./QCard.b3936020.js";import{c as h}from"./config.7e38babc.js";import{_ as K}from"./CompleteDialog.b8079208.js";import{a as j}from"./index.2cf0d985.js";import"./option-sizes.4546a983.js";import"./use-form.8230d3f4.js";import"./position-engine.e8f4f385.js";import"./selection.b35dc685.js";import"./create-uploader-component.d0353082.js";import"./format.3e32b8d9.js";var P=D({name:"QUploaderAddTrigger",setup(){return T(q,()=>{console.error("QUploaderAddTrigger needs to be child of QUploader")})}});const O={class:"col-6"},$={class:"col"},E={class:"q-mb-md row items-center"},L={class:"col-4"},G=d("\u30A4\u30F3\u30DD\u30FC\u30C8\u5148CKAN"),H={class:"col-8 flex justify-start"},J={key:0},R={class:"col-4"},M=a("div",{class:"cp_tooltip"},[d("\u30AB\u30BF\u30ED\u30B0\u524A\u9664\u6709\u7121 "),a("span",{class:"cp_tooltiptext"},[d(" \u2003 \u300C\u524A\u9664\u3059\u308B\u300D\u3092\u9078\u629E\u3057\u305F\u5834\u5408\u3001\u30A4\u30F3\u30DD\u30FC\u30C8\u5148\u306E"),a("br"),d(" \u2003 CKAN\u306B\u767B\u9332\u3055\u308C\u3066\u3044\u308B\u5168\u30AB\u30BF\u30ED\u30B0\u3092\u524A\u9664\u5F8C\u3001"),a("br"),d(" \u2003 \u30A4\u30F3\u30DD\u30FC\u30C8\u3092\u5B9F\u884C\u3057\u307E\u3059\u3002 ")])],-1),W={class:"col-8 flex justify-start"},X={class:"q-mb-md row"},Y={class:"col-4"},Z=d("\u8AAD\u307F\u8FBC\u307F\u30D5\u30A1\u30A4\u30EB"),ee={class:"col-8"},oe={class:"row no-wrap items-center q-pa-sm q-gutter-xs"},ae={class:"col"},le=a("div",{class:"q-uploader__title"},"Import files",-1),te={class:"q-uploader__subtitle"},se=d("Add File"),re=d("Import Files"),be={setup(ie){const x=C("api/v1/catalog/tool/localuploads"),n=C([]),b=w(),e=N({dialog:{isDisplay:!1,message:"",errorFlg:!1},importCkanType:"releaseCkan",deleteCkanCheck:"true"});function F(){return n.value.type!=="application/x-gzip"&&n.value.type!=="application/gzip"?(e.dialog.errorFlg=!0,e.dialog.message="gz\u5F62\u5F0F\u306E\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044\u3002",e.dialog.isDisplay=!0,!0):n.value.name.indexOf("(")!==-1||n.value.name.indexOf(")")!==-1?(e.dialog.errorFlg=!0,e.dialog.message="\u30D5\u30A1\u30A4\u30EB\u540D\u306B()\uFF08\u62EC\u5F27\uFF09\u3092\u542B\u307E\u306A\u3044\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044\u3002",e.dialog.isDisplay=!0,!0):!1}async function V(){if(F())return;let p=h.apiPrefix+"/import/release";e.importCkanType==="detailCkan"&&(p=h.apiPrefix+"/import/detail");let l={delete_ckan:e.deleteCkanCheck};const i=new FormData;let o={headers:{"content-type":"multipart/form-data"}},U=JSON.stringify(l);i.append("data",U),i.append("file",n.value);try{const f=await j.post(p,i,o);e.dialog.errorFlg=!1,e.dialog.message="\u30A4\u30F3\u30DD\u30FC\u30C8\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F\u3002",e.dialog.isDisplay=!0}catch(f){console.log("error message:",f.response.data.message),e.dialog.isDisplay=!0,e.dialog.message=f.response.data.message||`\u30A4\u30F3\u30DD\u30FC\u30C8\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,e.dialog.errorFlg=!0}}async function Q(p){return n.value=p[0],new Promise((l,i)=>{l(p)})}return(p,l)=>{const i=z("font");return c(),v("div",O,[t(B,{class:"q-card-background-white"},{default:r(()=>[t(S,null,{default:r(()=>[a("div",$,[a("div",E,[a("div",L,[t(i,{size:"3",color:"#1d468f"},{default:r(()=>[G]),_:1})]),a("div",H,[t(u,{modelValue:s(e).importCkanType,"onUpdate:modelValue":l[0]||(l[0]=o=>s(e).importCkanType=o),val:"releaseCkan",label:"\u6A2A\u65AD\u691C\u7D22\u7528CKAN",color:"light-blue-10"},null,8,["modelValue"]),s(b).loginInfo.detailCkanAddr?(c(),v("div",J,[t(u,{modelValue:s(e).importCkanType,"onUpdate:modelValue":l[1]||(l[1]=o=>s(e).importCkanType=o),val:"detailCkan",label:"\u8A73\u7D30\u691C\u7D22\u7528CKAN",style:{"margin-left":"16px"},color:"light-blue-10"},null,8,["modelValue"])])):m("",!0)]),a("div",R,[t(i,{size:"3",color:"#1d468f"},{default:r(()=>[M]),_:1})]),a("div",W,[t(u,{modelValue:s(e).deleteCkanCheck,"onUpdate:modelValue":l[2]||(l[2]=o=>s(e).deleteCkanCheck=o),val:"true",label:"\u524A\u9664\u3059\u308B",color:"light-blue-10"},null,8,["modelValue"]),t(u,{modelValue:s(e).deleteCkanCheck,"onUpdate:modelValue":l[3]||(l[3]=o=>s(e).deleteCkanCheck=o),val:"false",label:"\u524A\u9664\u3057\u306A\u3044",style:{"margin-left":"16px"},color:"light-blue-10"},null,8,["modelValue"])])]),a("div",X,[a("div",Y,[t(i,{size:"3",color:"#1d468f"},{default:r(()=>[Z]),_:1})]),a("div",ee,[t(I,{name:"uploader",style:{width:"100%"},"field-name":"file",url:x.value,onFinish:l[4]||(l[4]=o=>V()),factory:Q,"max-files":"1"},{header:r(o=>[a("div",oe,[o.isUploading?(c(),_(A,{key:0,class:"q-uploader__spinner"})):m("",!0),a("div",ae,[le,a("div",te,y(o.uploadSizeLabel)+" / "+y(o.uploadProgressLabel),1)]),o.canAddFiles?(c(),_(g,{key:1,type:"a",icon:"add_box",round:"",dense:"",flat:""},{default:r(()=>[t(P),t(k,null,{default:r(()=>[se]),_:1})]),_:1})):m("",!0),o.canUpload?(c(),_(g,{key:2,icon:"cloud_upload",onClick:o.upload,round:"",dense:"",flat:""},{default:r(()=>[t(k,null,{default:r(()=>[re]),_:1})]),_:2},1032,["onClick"])):m("",!0)])]),_:1},8,["url"])])])])]),_:1})]),_:1}),t(K,{dialogInfo:s(e).dialog,onCloseDialog:l[5]||(l[5]=o=>s(e).dialog.isDisplay=!1)},null,8,["dialogInfo"])])}}};export{be as default};
