import{Q as se}from"./QCard.b3936020.js";import{u as oe,p as A,o as ne,I as j,t as le,x as ie,d as B,q as W,m as ce}from"./index.f310304c.js";import{P as R}from"./Loading.b296f620.js";import{_ as pe}from"./CompleteDialog.b8079208.js";import{a as _}from"./index.2cf0d985.js";import{c as y}from"./config.7e38babc.js";import"./render.ce2d7a1b.js";import"./QBtn.5c02f783.js";const ue={class:"col-12 q-layout-padding flex justify-center content-center"},De={setup(ge){const o=oe(),C=ce(),s=A({isDisplay:!1,message:"",errorFlg:!1}),L=A({languageList:[]});R.show(),ne(function(){console.log("-- loginLoad.vue onMounted --");var e=location.href.indexOf("/#/"),l=location.href.slice(0,e+3);_.post(y.apiPrefix+"/auth/login",{keycloak_uuid:o.authInfo.keycloakState,auth_code:o.authInfo.keycloakCode,catalog_tool_url:l}).then(r=>{o.updateUser({ckan:r.data.ckan,username:r.data.ckan_username,caddeUserId:r.data.cadde_user_id,caddeUserIdList:r.data.cadde_user_id_list,releaseCkanAddr:r.data.release_ckan_addr,detailCkanAddr:r.data.detail_ckan_addr,sysadmin:r.data.sysadmin}),o.initItemListParams(),o.initCkanItemListParams(),o.initConfigValue(),_.get("datalist/languageList.json").then(a=>{L.languageList=a.data,_.get("datalist/itemValue.json").then(g=>{var t=g.data[0].select_item;o.updateItemList({frequency:n(t,"frequency"),caddecResourceType:n(t,"caddec_resource_type"),caddecContractRequired:n(t,"caddec_contract_required"),caddecRequired:n(t,"caddec_required"),accessRights:n(t,"access_rights"),tradingPolicyContractType:n(t,"trading_policy_contract_type"),tradingPolicyNda:n(t,"trading_policy_nda"),tradingPolicyUseApplication:n(t,"trading_policy_use_application"),scopeOfDisclosure:n(t,"scope_of_disclosure"),termsOfUsePermissibleRegion:n(t,"terms_of_use_permissible_region"),privacyPolicyContainsPersonalData:n(t,"privacy_policy_contains_personal_data"),dataEffectivePeriod:n(t,"data_effective_period"),usageLicensePeriod:n(t,"usage_license_period"),fee:n(t,"fee"),warrantyExpressWarranty:n(t,"warranty_express_warranty"),warrantyLegalCompliance:n(t,"warranty_legal_compliance"),mimetype:n(t,"mime_type"),compressFormat:n(t,"compress_format"),packageFormat:n(t,"package_format"),schemaType:n(t,"schema_type"),language:L.languageList}),_.get(y.apiPrefix+"/config").then(c=>{o.updateConfigValue({geonames:c.data.geonames.use_geonames,theme:c.data.machine_learn.theme,keyword:c.data.machine_learn.keyword,spatial:c.data.machine_learn.spatial,temporal:c.data.machine_learn.temporal}),o.initField(["template"]),_.get(y.apiPrefix+"/template").then(u=>{var d=u.data.template.catalog_value;V(d.datasetinfo,["state","template"]),z(d.datajacket,["template"]),J(d.datasetoptionalinfo,["state","template"]),Q(d.userterms,["state","template"]),console.log("LoginLoad.vue \u30C6\u30F3\u30D7\u30EC\u30FC\u30C8\u5024\u30B3\u30DF\u30C3\u30C8\u5F8C",o.template);var k=[];_.get(y.apiPrefix+"/licenselist").then(f=>{for(var v=f.data,m=0;m<v.length;m++)k.push({label:v[m].title,value:v[m].id,url:v[m].url});o.updateCkanItemList({licenseId:k}),_.get(y.apiPrefix+"/ckaninfo").then(async i=>{for(var p=0;p<i.data.length;p++)if(i.data[p].ckan_type==="release")var F=i.data[p].title,I=i.data[p].description,T=i.data[p].url,U="",b="";else if(i.data[p].ckan_type==="detail")var x=i.data[p].title,w=i.data[p].description,O=i.data[p].url,S="",q="";o.updateCkanCataloginfo({releaseCkanCatalogTitle:F,releaseCkanCatalogDescription:I,releaseCkanCatalogUrl:T,releaseCkanCatalogPublisher:U,releaseCkanCatalogPublisherExplanation:b,detailCkanCatalogTitle:x,detaikCkanCatalogDescription:w,detailCkanCatalogUrl:O,detailCkanCatalogPublisher:S,detailCkanCatalogPublisherExplanation:q}),o.loginInfo.sysadmin===!0?C.push("/userManager").then(h=>{j(h)||o.updateMode({mode:"userManagement",ckanType:"",isBothCatalog:!1})}):C.push("/menuSelect").then(h=>{j(h)||o.updateMode({mode:"menuSelect",ckanType:"",isBothCatalog:!1})})}).catch(i=>{console.log("error message:",i.response.data.message),s.isDisplay=!0,s.message=i.response.data.message||`\u30AB\u30BF\u30ED\u30B0\u30B5\u30A4\u30C8\u60C5\u5831\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,s.errorFlg=!0})}).catch(f=>{console.log("error message:",f.response.data.message),s.isDisplay=!0,s.message=f.response.data.message||`\u30E9\u30A4\u30BB\u30F3\u30B9\u30EA\u30B9\u30C8\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,s.errorFlg=!0})}).catch(u=>{console.log("error message:",u.response.data.message),s.isDisplay=!0,s.message=u.response.data.message||`\u30C6\u30F3\u30D7\u30EC\u30FC\u30C8\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,s.errorFlg=!0})}).catch(c=>{console.log("error message:",c.response.data.message),s.isDisplay=!0,s.message=c.response.data.message||`\u5916\u90E8\u30B5\u30FC\u30D3\u30B9\u304A\u3088\u3073\u6A5F\u68B0\u5B66\u7FD2\u4F7F\u7528\u6709\u7121\u78BA\u8A8D\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,s.errorFlg=!0})}).catch(g=>{console.log(`error message:\u9078\u629E\u80A2\u8868\u793A\u30C7\u30FC\u30BF\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`),s.isDisplay=!0,s.message=`\u9078\u629E\u80A2\u8868\u793A\u30C7\u30FC\u30BF\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,s.errorFlg=!0})}).catch(a=>{console.log(`error message: Language\u30D5\u30A1\u30A4\u30EB\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`),s.isDisplay=!0,s.message=`Language\u30D5\u30A1\u30A4\u30EB\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,s.errorFlg=!0}),R.hide()}).catch(r=>{R.hide(),console.log("error message:",r.response.data.message),s.isDisplay=!0,s.message=r.response.data.message||`\u8A8D\u8A3C\u30ED\u30B0\u30A4\u30F3\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,s.errorFlg=!0})});function V(e,l){for(var r=0;r<l.length;r++)o.updateDatasetinfo({catalogTitle:e.title,catalogDescription:e.notes,datasetDescriptionUrl:e.url,datasetIdForDetail:e.caddec_dataset_id_for_detail,registOrg:e.regist_org,publisherId:e.caddec_provider_id,publisher:e.publisher_name,publisherUri:e.publisher_uri,creator:e.creator_name,creatorUrl:e.creator_url,contactPoint:e.contact_name,contactPointUrl:e.contact_url,storeType:l[r]})}function z(e,l){console.log("commitDatajacket",e);var r=[];if(e.length)for(var a=0;a<e.length;a++){var g=e[a].contractRequired,t=e[a].connectRequired,c=e[a].filename||"",u=e[a].dataname||"",d=e[a].description||"",k=e[a].dataurl||"",f=e[a].downloadUrl||"",v=e[a].explainurl||"",m=e[a].size||"",i=e[a].columnName||"",p=e[a].mimetype||"",F=e[a].format||"",I=e[a].compressFormat||"",T=e[a].compressFormatOther||"",U=e[a].packageFormat||"",b=e[a].packageFormatOther||"",x=e[a].schema||"",w=e[a].schemaType||"",O=e[a].ngsiEntityType||"",S=e[a].ngsiTenant||"",q=e[a].ngsiServicePath||"",h=e[a].ngsiDataModel||[];if(e[a].getResourceIDForProvenance)if(e[a].getResourceIDForProvenance.label&&e[a].getResourceIDForProvenance.value)var N=e[a].getResourceIDForProvenance.label,M=e[a].getResourceIDForProvenance.value;else N="",M="";var $=e[a].resourceIDForProvenance||"",H=e[a].previousEventId||"",K=e[a].dataServiceTitle||"",G=e[a].dataServiceEndpointUrl||"",X=e[a].dataServiceEndpointDescription||"",Y=e[a].urlForProvenance||"",Z=e[a].caddeUserId||"";if(e[a].resourceType.value)if(e[a].resourceType.value==="file/http")var D="\u30D5\u30A1\u30A4\u30EB\u63D0\u4F9B(HTTP)",P="file/http";else e[a].resourceType.value==="file/ftp"?(D="\u30D5\u30A1\u30A4\u30EB\u63D0\u4F9B(FTP)",P="file/ftp"):e[a].resourceType.value==="api/ngsi"?(D="API\u63D0\u4F9B(NGSI API)",P="api/ngsi"):(D="",P="");var ee=e[a].license_title||"",ae=e[a].licenseurl||"",re=e[a].issued||"",te=e[a].label||"";r.push({label:te,dataname:u,filename:c,description:d,dataurl:k,downloadUrl:f,explainurl:v,size:m,columnName:i,mimetype:p,format:F,compressFormat:I,compressFormatOther:T,packageFormat:U,packageFormatOther:b,schema:x,schemaType:w,ngsiEntityType:O,ngsiTenant:S,ngsiServicePath:q,ngsiDataModel:h,contractRequired:g,connectRequired:t,getResourceIDForProvenance:{label:N,value:M},resourceIDForProvenance:$,previousEventId:H,dataServiceTitle:K,dataServiceEndpointUrl:G,dataServiceEndpointDescription:X,urlForProvenance:Y,caddeUserId:Z,resourceType:{label:D,value:P},licensetitle:ee,licenseurl:ae,issued:re})}for(var E=0;E<l.length;E++)o.updateFiledataDetails({filedataDetails:r,storeType:l[E]});console.log("\u30C6\u30F3\u30D7\u30EC\u30FC\u30C8\u53D6\u5F97\u5F8C\u306E\u30B3\u30DF\u30C3\u30C8",o.template)}function J(e,l){for(var r=0;r<l.length;r++)o.updateDatasetOptionalInfoParameters({selectThemes:e.theme,selectTags:e.tags,vocabulary:e.vocabulary,term:e.term,selectLanguage:e.language,frequency:e.frequency,spatialUrl:e.spatial_url,spatialName:e.spatial_text,spatial:e.spatial,start:e.temporal_start,end:e.temporal_end,storeType:l[r]})}function Q(e,l){for(var r=0;r<l.length;r++)o.updateUserTerms({selectedTab:e.selected_tab,termName:e.license_title,termNameUrl:e.license_url,usrRight:e.rights,accessRights:e.access_rights,accessRightsUrl:e.access_rights_url,haspolicyUrl:e.haspolicy_url,provWasGeneratedByUrl:e.prov_was_generated_by_url,conformsTo:e.conforms_to,contractType:e.trading_policy_contract_type,secrecy:e.trading_policy_nda,useApplication:e.trading_policy_use_application,useApplicationOther:e.trading_policy_use_application_free,scopeOfDisclosure:e.scope_of_disclosure,scopeOfDisclosureOther:e.scope_of_disclosure_free,permissionResion:e.terms_of_use_permissible_region,permissionResionOther:e.terms_of_use_permissible_region_free,notices:e.terms_of_use_notices,personalData:e.privacy_policy_contains_personal_data,personalDataOther:e.privacy_policy_contains_personal_data_free,dataEffectivePeriodSelectTerms:e.data_effective_period_term,startDate:e.data_effective_period_start,endDate:e.data_effective_period_end,dataEffectivePeriodFreefield:e.data_effective_period_free,usageLicensePeriodSelectTerms:e.usage_license_period_term,deadline:e.usage_license_period_deadline,period:e.usage_license_period_period,unit:e.usage_license_period_unit,usageLicensePeriodFreefield:e.usage_license_period_free,fee:e.fee,salesInfoUrl:e.sales_info_url,priceRange:e.pricing_price_range,noticesOfPrice:e.pricing_notices_of_price,expressWarranty:e.warranty_express_warranty,expressWarrantyOther:e.warranty_express_warranty_free,leagalCompliance:e.warranty_legal_compliance,leagalComplianceOther:e.warranty_legal_compliance_free,storeType:l[r]})}function n(e,l){var r=[],a=[];for(var g in e){var t=e[g].ckanKeyName;if(t===l){r=e[g].valueMap;break}}for(var c in r)a.push({label:r[c],value:c});var u=JSON.stringify(a);return JSON.parse(u)}return(e,l)=>(le(),ie("div",ue,[B(se,{class:"q-card-background-white",style:{"max-width":"80%",width:"100%"}}),B(pe,{dialogInfo:W(s),onCloseDialog:l[0]||(l[0]=r=>W(C).push("/"))},null,8,["dialogInfo"])]))}};export{De as default};
