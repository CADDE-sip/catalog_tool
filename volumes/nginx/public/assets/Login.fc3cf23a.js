import{Q as N}from"./QInput.216185b9.js";import{Q as me,a as ge}from"./QBtn.5c02f783.js";import{Q as ue,b as _e}from"./QCard.b3936020.js";import{c as y}from"./config.7e38babc.js";import{P}from"./Loading.b296f620.js";import{u as de,p as fe,t as F,x as U,d as v,y as C,m as ve,E as he,H as c,F as ye,aa as De,q as g,I as O,B as ke,G as Pe}from"./index.f310304c.js";import{a as h}from"./index.2cf0d985.js";import"./use-key-composition.d2263223.js";import"./create-uploader-component.d0353082.js";import"./render.ce2d7a1b.js";import"./format.3e32b8d9.js";import"./uid.42677368.js";import"./use-form.8230d3f4.js";const Ce={class:"col-12 q-layout-padding flex justify-center content-center"},be={class:"column"},Fe=c("div",{class:"main-label",color:"#1d468f"},"\u30E6\u30FC\u30B6\u8A8D\u8A3C",-1),Ue=c("div",{class:"sub-label"}," CKAN\u30E6\u30FC\u30B6\u540D\u3068CKAN\u30E6\u30FC\u30B6\u30D1\u30B9\u30EF\u30FC\u30C9\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002 ",-1),we={class:"column q-mt-xl"},xe=c("div",{class:"col-11 text-left input-label"},"CKAN\u30E6\u30FC\u30B6\u540D",-1),Ie={class:"col-11 input-area"},Te={class:"column q-mt-lg"},Ee=c("div",{class:"text-left input-label"},"CKAN\u30E6\u30FC\u30B6\u30D1\u30B9\u30EF\u30FC\u30C9",-1),Ne={class:"col-11 input-area"},Oe={class:"row q-mt-xl"},qe={class:"col-12 text-right"},$e={setup(Ae){const l=de(),w=ve(),x={ckanUsername:"CKAN\u30E6\u30FC\u30B6\u540D\u306F\u5165\u529B\u5FC5\u9808\u9805\u76EE\u3067\u3059\u3002\u5165\u529B\u3092\u304A\u9858\u3044\u3057\u307E\u3059\u3002",ckanUserPassword:"CKAN\u30E6\u30FC\u30B6\u30D1\u30B9\u30EF\u30FC\u30C9\u306F\u5165\u529B\u5FC5\u9808\u9805\u76EE\u3067\u3059\u3002\u5165\u529B\u3092\u304A\u9858\u3044\u3057\u307E\u3059\u3002"},o=fe({ckanUsername:"",ckanUserPassword:"",isPwd:!0,loginErrorMessage:[],languageList:[]});function q(){if(P.show(),o.loginErrorMessage=[],A(),o.loginErrorMessage.length){console.log("attr.loginErrorMessage\u306Etrue\u30EB\u30FC\u30C8"),console.log(o.loginErrorMessage),P.hide();return}h.post(y.apiPrefix+"/login",{username:o.ckanUsername,password:o.ckanUserPassword}).then(e=>{l.updateUser({ckan:e.data.ckan,username:o.ckanUsername,releaseCkanAddr:e.data.release_ckan_addr,detailCkanAddr:e.data.detail_ckan_addr,sysadmin:e.data.sysadmin}),l.updateAuthInfo({keycloakState:"",keycloakCode:e.data.auth_code}),l.initItemListParams(),l.initCkanItemListParams(),l.initConfigValue(),h.get("datalist/languageList.json").then(r=>{o.languageList=r.data,h.get("datalist/itemValue.json").then(t=>{var a=t.data[0].select_item;l.updateItemList({frequency:s(a,"frequency"),caddecResourceType:s(a,"caddec_resource_type"),caddecContractRequired:s(a,"caddec_contract_required"),caddecRequired:s(a,"caddec_required"),accessRights:s(a,"access_rights"),tradingPolicyContractType:s(a,"trading_policy_contract_type"),tradingPolicyNda:s(a,"trading_policy_nda"),tradingPolicyUseApplication:s(a,"trading_policy_use_application"),scopeOfDisclosure:s(a,"scope_of_disclosure"),termsOfUsePermissibleRegion:s(a,"terms_of_use_permissible_region"),privacyPolicyContainsPersonalData:s(a,"privacy_policy_contains_personal_data"),dataEffectivePeriod:s(a,"data_effective_period"),usageLicensePeriod:s(a,"usage_license_period"),fee:s(a,"fee"),warrantyExpressWarranty:s(a,"warranty_express_warranty"),warrantyLegalCompliance:s(a,"warranty_legal_compliance"),mimetype:s(a,"mime_type"),compressFormat:s(a,"compress_format"),packageFormat:s(a,"package_format"),schemaType:s(a,"schema_type"),language:o.languageList}),h.get(y.apiPrefix+"/config").then(n=>{l.updateConfigValue({geonames:n.data.geonames.use_geonames,theme:n.data.machine_learn.theme,keyword:n.data.machine_learn.keyword,spatial:n.data.machine_learn.spatial,temporal:n.data.machine_learn.temporal}),l.initField(["template"]),h.get(y.apiPrefix+"/template").then(p=>{var i=p.data.template.catalog_value;M(i.datasetinfo,["state","template"]),S(i.datajacket,["template"]),R(i.datasetoptionalinfo,["state","template"]),L(i.userterms,["state","template"]);var u=[];h.get(y.apiPrefix+"/licenselist").then(_=>{for(var d=_.data,m=0;m<d.length;m++)u.push({label:d[m].title,value:d[m].id,url:d[m].url});l.updateCkanItemList({licenseId:u}),l.loginInfo.sysadmin===!0?w.push("/userManager").then(f=>{O(f)||(I(),l.updateMode({mode:"userManagement",ckanType:"",isBothCatalog:!1}))}):w.push("/menuSelect").then(f=>{O(f)||(I(),l.updateMode({mode:"menuSelect",ckanType:"",isBothCatalog:!1}))})}).catch(_=>{console.log("error message:",_.response.data.message),completeDialog.isDisplay=!0,completeDialog.message=_.response.data.message||`\u30E9\u30A4\u30BB\u30F3\u30B9\u30EA\u30B9\u30C8\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,completeDialog.errorFlg=!0})}).catch(p=>{console.log("error message:",p.response.data.message),completeDialog.isDisplay=!0,completeDialog.message=p.response.data.message||`\u30C6\u30F3\u30D7\u30EC\u30FC\u30C8\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,completeDialog.errorFlg=!0})}).catch(n=>{console.log("error message:",n.response.data.message),completeDialog.isDisplay=!0,completeDialog.message=n.response.data.message||`\u5916\u90E8\u30B5\u30FC\u30D3\u30B9\u304A\u3088\u3073\u6A5F\u68B0\u5B66\u7FD2\u4F7F\u7528\u6709\u7121\u78BA\u8A8D\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,completeDialog.errorFlg=!0})}).catch(t=>{console.log(`error message:\u9078\u629E\u80A2\u8868\u793A\u30C7\u30FC\u30BF\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`),completeDialog.isDisplay=!0,completeDialog.message=`\u9078\u629E\u80A2\u8868\u793A\u30C7\u30FC\u30BF\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,completeDialog.errorFlg=!0})}).catch(r=>{console.log(`error message: Language\u30D5\u30A1\u30A4\u30EB\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`),completeDialog.isDisplay=!0,completeDialog.message=`Language\u30D5\u30A1\u30A4\u30EB\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,completeDialog.errorFlg=!0}),P.hide()}).catch(e=>{P.hide(),console.log("error message:",e.response.data.message),completeDialog.isDisplay=!0,completeDialog.message=e.response.data.message||`\u30ED\u30B0\u30A4\u30F3\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002
\u7BA1\u7406\u8005\u306B\u554F\u3044\u5408\u308F\u305B\u3066\u304F\u3060\u3055\u3044\u3002`,completeDialog.errorFlg=!0})}function A(e){for(e in x)o[e]||o.loginErrorMessage.push(x[e])}function M(e,r){for(var t=0;t<r.length;t++)l.updateDatasetinfo({catalogTitle:e.title,catalogDescription:e.notes,datasetDescriptionUrl:e.url,datasetIdForDetail:e.caddec_dataset_id_for_detail,registOrg:e.regist_org,publisherId:e.caddec_provider_id,publisher:e.publisher_name,publisherUri:e.publisher_uri,creator:e.creator_name,creatorUrl:e.creator_url,contactPoint:e.contact_name,contactPointUrl:e.contact_url,storeType:r[t]})}function S(e,r){var t=[];if(e.length)for(var a=0;a<e.length;a++){var n=e[a].contractRequired,p=e[a].connectRequired,i=e[a].filename||"",u=e[a].dataname||"",_=e[a].description||"",d=e[a].dataurl||"",m=e[a].downloadUrl||"",f=e[a].explainurl||"",V=e[a].size||"",K=e[a].columnName||"",B=e[a].mimetype||"",Q=e[a].format||"",j=e[a].compressFormat||"",W=e[a].compressFormatOther||"",z=e[a].packageFormat||"",H=e[a].packageFormatOther||"",J=e[a].schema||"",$=e[a].schemaType||"",G=e[a].ngsiEntityType||"",Y=e[a].ngsiTenant||"",X=e[a].ngsiServicePath||"",Z=e[a].ngsiDataModel||[];if(e[a].getResourceIDForProvenance)if(e[a].getResourceIDForProvenance.label&&e[a].getResourceIDForProvenance.value)var T=e[a].getResourceIDForProvenance.label,E=e[a].getResourceIDForProvenance.value;else T="",E="";var ee=e[a].resourceIDForProvenance||"",ae=e[a].previousEventId||"",re=e[a].dataServiceTitle||"",te=e[a].dataServiceEndpointUrl||"",se=e[a].dataServiceEndpointDescription||"",oe=e[a].urlForProvenance||"",le=e[a].caddeUserId||"";if(e[a].resourceType.value)if(e[a].resourceType.value==="file/http")var D="\u30D5\u30A1\u30A4\u30EB\u63D0\u4F9B(HTTP)",k="file/http";else e[a].resourceType.value==="file/ftp"?(D="\u30D5\u30A1\u30A4\u30EB\u63D0\u4F9B(FTP)",k="file/ftp"):e[a].resourceType.value==="api/ngsi"?(D="API\u63D0\u4F9B(NGSI API)",k="api/ngsi"):(D="",k="");var ne=e[a].license_title||"",ie=e[a].licenseurl||"",ce=e[a].issued||"",pe=e[a].label||"";t.push({label:pe,dataname:u,filename:i,description:_,dataurl:d,downloadUrl:m,explainurl:f,size:V,columnName:K,mimetype:B,format:Q,compressFormat:j,compressFormatOther:W,packageFormat:z,packageFormatOther:H,schema:J,schemaType:$,ngsiEntityType:G,ngsiTenant:Y,ngsiServicePath:X,ngsiDataModel:Z,contractRequired:n,connectRequired:p,getResourceIDForProvenance:{label:T,value:E},resourceIDForProvenance:ee,previousEventId:ae,dataServiceTitle:re,dataServiceEndpointUrl:te,dataServiceEndpointDescription:se,urlForProvenance:oe,caddeUserId:le,resourceType:{label:D,value:k},licensetitle:ne,licenseurl:ie,issued:ce})}for(var b=0;b<r.length;b++)l.updateFiledataDetails({filedataDetails:t,storeType:r[b]})}function R(e,r){for(var t=0;t<r.length;t++)l.updateDatasetOptionalInfoParameters({selectThemes:e.theme,selectTags:e.tags,vocabulary:e.vocabulary,term:e.term,selectLanguage:e.language,frequency:e.frequency,spatialUrl:e.spatial_url,spatialName:e.spatial_text,spatial:e.spatial,start:e.temporal_start,end:e.temporal_end,storeType:r[t]})}function L(e,r){for(var t=0;t<r.length;t++)l.updateUserTerms({selectedTab:e.selected_tab,termName:e.license_title,termNameUrl:e.license_url,usrRight:e.rights,accessRights:e.access_rights,accessRightsUrl:e.access_rights_url,haspolicyUrl:e.haspolicy_url,provWasGeneratedByUrl:e.prov_was_generated_by_url,conformsTo:e.conforms_to,contractType:e.trading_policy_contract_type,secrecy:e.trading_policy_nda,useApplication:e.trading_policy_use_application,useApplicationOther:e.trading_policy_use_application_free,scopeOfDisclosure:e.scope_of_disclosure,scopeOfDisclosureOther:e.scope_of_disclosure_free,permissionResion:e.terms_of_use_permissible_region,permissionResionOther:e.terms_of_use_permissible_region_free,notices:e.terms_of_use_notices,personalData:e.privacy_policy_contains_personal_data,personalDataOther:e.privacy_policy_contains_personal_data_free,dataEffectivePeriodSelectTerms:e.data_effective_period_term,startDate:e.data_effective_period_start,endDate:e.data_effective_period_end,dataEffectivePeriodFreefield:e.data_effective_period_free,usageLicensePeriodSelectTerms:e.usage_license_period_term,deadline:e.usage_license_period_deadline,period:e.usage_license_period_period,unit:e.usage_license_period_unit,usageLicensePeriodFreefield:e.usage_license_period_free,fee:e.fee,salesInfoUrl:e.sales_info_url,priceRange:e.pricing_price_range,noticesOfPrice:e.pricing_notices_of_price,expressWarranty:e.warranty_express_warranty,expressWarrantyOther:e.warranty_express_warranty_free,leagalCompliance:e.warranty_legal_compliance,leagalComplianceOther:e.warranty_legal_compliance_free,storeType:r[t]})}function s(e,r){var t=[],a=[];for(var n in e){var p=e[n].ckanKeyName;if(p===r){t=e[n].valueMap;break}}for(var i in t)a.push({label:t[i],value:i});var u=JSON.stringify(a);return JSON.parse(u)}function I(){h.get(y.apiPrefix+"/ckaninfo").then(async e=>{if(e.status===200){for(var r=0;r<e.data.length;r++)if(e.data[r].ckan_type==="release")var t=e.data[r].title,a=e.data[r].description,n=e.data[r].url,p="",i="";else if(e.data[r].ckan_type==="detail")var u=e.data[r].title,_=e.data[r].description,d=e.data[r].url,m="",f="";l.updateCkanCataloginfo({releaseCkanCatalogTitle:t,releaseCkanCatalogDescription:a,releaseCkanCatalogUrl:n,releaseCkanCatalogPublisher:p,releaseCkanCatalogPublisherExplanation:i,detailCkanCatalogTitle:u,detaikCkanCatalogDescription:_,detailCkanCatalogUrl:d,detailCkanCatalogPublisher:m,detailCkanCatalogPublisherExplanation:f})}else console.log("\u30ED\u30B0\u30A4\u30F3\u3057\u305FCKAN\u306E\u30AB\u30BF\u30ED\u30B0\u60C5\u5831\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F")}).catch(e=>{console.log("\u30ED\u30B0\u30A4\u30F3\u3057\u305FCKAN\u306E\u30AB\u30BF\u30ED\u30B0\u60C5\u5831\u306E\u53D6\u5F97\u6642\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F",e)})}return(e,r)=>{const t=he("font");return F(),U("div",Ce,[v(ue,{class:"q-card-background-white",style:{"max-width":"45%",width:"100%"}},{default:C(()=>[v(_e,{class:"q-pa-xl"},{default:C(()=>[c("div",be,[Fe,Ue,(F(!0),U(ye,null,De(g(o).loginErrorMessage,a=>(F(),U("div",{key:a},[v(t,{class:"error-msg"},{default:C(()=>[ke(Pe(a),1)]),_:2},1024)]))),128))]),c("div",we,[xe,c("div",Ie,[v(N,{modelValue:g(o).ckanUsername,"onUpdate:modelValue":r[0]||(r[0]=a=>g(o).ckanUsername=a),label:"ckan username"},null,8,["modelValue"])])]),c("div",Te,[Ee,c("div",Ne,[v(N,{modelValue:g(o).ckanUserPassword,"onUpdate:modelValue":r[2]||(r[2]=a=>g(o).ckanUserPassword=a),label:"ckan user password",type:g(o).isPwd?"password":"text"},{default:C(()=>[v(me,{size:"32px",name:g(o).isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:r[1]||(r[1]=a=>g(o).isPwd=!g(o).isPwd)},null,8,["name"])]),_:1},8,["modelValue","type"])])]),c("div",Oe,[c("div",qe,[v(ge,{color:"light-blue-10",onClick:r[3]||(r[3]=a=>q()),label:"\u30ED\u30B0\u30A4\u30F3"})])])]),_:1})]),_:1})])}}};export{$e as default};
