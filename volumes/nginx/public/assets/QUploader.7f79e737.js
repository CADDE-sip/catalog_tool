var ue=Object.defineProperty,le=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var W=(e,i,a)=>i in e?ue(e,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[i]=a,A=(e,i)=>{for(var a in i||(i={}))se.call(i,a)&&W(e,a,i[a]);if(I)for(var a of I(i))de.call(i,a)&&W(e,a,i[a]);return e},Q=(e,i)=>le(e,re(i));import{r as U,c as F,w as K,f as V,L as X,K as $,h as G,P as ce,g as fe,k as ve}from"./index.f310304c.js";import{u as he,v as J,a as me,b as ge,c as pe,r as Y,s as ye,p as Z,d as Se}from"./position-engine.e8f4f385.js";import{u as be,f as we,a as Fe,g as Te,b as Pe,h as Ee,c as xe,i as Ce}from"./CompleteDialog.b8079208.js";import{c as Oe,h as qe}from"./render.ce2d7a1b.js";import{g as ke}from"./config.7e38babc.js";import{c as ee}from"./selection.b35dc685.js";import{c as ze}from"./create-uploader-component.d0353082.js";var Ie=Oe({name:"QTooltip",inheritAttrs:!1,props:Q(A(A(A({},he),be),we),{maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:J},self:{type:String,default:"top middle",validator:J},offset:{type:Array,default:()=>[14,14],validator:me},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}}),emits:[...Fe],setup(e,{slots:i,emit:a,attrs:p}){let s,c;const T=fe(),{proxy:{$q:f}}=T,S=U(null),h=U(!1),B=F(()=>Z(e.anchor,f.lang.rtl)),D=F(()=>Z(e.self,f.lang.rtl)),H=F(()=>e.persistent!==!0),{registerTick:O,removeTick:t}=Te(),{registerTimeout:u,removeTimeout:v}=Pe(),{transition:n,transitionStyle:r}=Ee(e,h),{localScrollTarget:q,changeScrollEvent:R,unconfigureScrollTarget:L}=ge(e,j),{anchorEl:d,canShow:P,anchorEvents:y}=pe({showing:h,configureAnchorEl:oe}),{show:M,hide:E}=xe({showing:h,canShow:P,handleShow:x,handleHide:z,hideOnRouteChange:H,processOnMount:!0});Object.assign(y,{delayShow:te,delayHide:ae});const{showPortal:k,hidePortal:o,renderPortal:b}=Ce(T,S,ie);if(f.platform.is.mobile===!0){const l={anchorEl:d,innerRef:S,onClickOutside(w){return E(w),w.target.classList.contains("q-dialog__backdrop")&&ve(w),!0}},N=F(()=>e.modelValue===null&&e.persistent!==!0&&h.value===!0);K(N,w=>{(w===!0?Se:Y)(l)}),V(()=>{Y(l)})}function x(l){t(),v(),k(),O(()=>{c=new MutationObserver(()=>C()),c.observe(S.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),C(),j()}),s===void 0&&(s=K(()=>f.screen.width+"|"+f.screen.height+"|"+e.self+"|"+e.anchor+"|"+f.lang.rtl,C)),u(()=>{k(!0),a("show",l)},e.transitionDuration)}function z(l){t(),v(),o(),m(),u(()=>{o(!0),a("hide",l)},e.transitionDuration)}function m(){c!==void 0&&(c.disconnect(),c=void 0),s!==void 0&&(s(),s=void 0),L(),X(y,"tooltipTemp")}function C(){const l=S.value;d.value===null||!l||ye({el:l,offset:e.offset,anchorEl:d.value,anchorOrigin:B.value,selfOrigin:D.value,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function te(l){if(f.platform.is.mobile===!0){ee(),document.body.classList.add("non-selectable");const N=d.value,w=["touchmove","touchcancel","touchend","click"].map(_=>[N,_,"delayHide","passiveCapture"]);$(y,"tooltipTemp",w)}u(()=>{M(l)},e.delay)}function ae(l){v(),f.platform.is.mobile===!0&&(X(y,"tooltipTemp"),ee(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),u(()=>{E(l)},e.hideDelay)}function oe(){if(e.noParentEvent===!0||d.value===null)return;const l=f.platform.is.mobile===!0?[[d.value,"touchstart","delayShow","passive"]]:[[d.value,"mouseenter","delayShow","passive"],[d.value,"mouseleave","delayHide","passive"]];$(y,"anchor",l)}function j(){if(d.value!==null||e.scrollTarget!==void 0){q.value=ke(d.value,e.scrollTarget);const l=e.noParentEvent===!0?C:E;R(q.value,l)}}function ne(){return h.value===!0?G("div",Q(A({},p),{ref:S,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",p.class],style:[p.style,r.value],role:"complementary"}),qe(i.default)):null}function ie(){return G(ce,{name:n.value,appear:!0},ne)}return V(m),Object.assign(T.proxy,{updatePosition:C}),b}});function g(e){return typeof e=="function"?e:()=>e}const Ae={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>e=>e.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},Ue=["factory-failed","uploaded","failed","uploading"];function He({props:e,emit:i,helpers:a}){const p=U([]),s=U([]),c=U(0),T=F(()=>({url:g(e.url),method:g(e.method),headers:g(e.headers),formFields:g(e.formFields),fieldName:g(e.fieldName),withCredentials:g(e.withCredentials),sendRaw:g(e.sendRaw),batch:g(e.batch)})),f=F(()=>c.value>0),S=F(()=>s.value.length>0);let h;function B(){p.value.forEach(t=>{t.abort()}),s.value.length>0&&(h=!0)}function D(){const t=a.queuedFiles.value.slice(0);a.queuedFiles.value=[],T.value.batch(t)?H(t):t.forEach(u=>{H([u])})}function H(t){if(c.value++,typeof e.factory!="function"){O(t,{});return}const u=e.factory(t);if(!u)i("factory-failed",new Error("QUploader: factory() does not return properly"),t),c.value--;else if(typeof u.catch=="function"&&typeof u.then=="function"){s.value.push(u);const v=n=>{a.isAlive()===!0&&(s.value=s.value.filter(r=>r!==u),s.value.length===0&&(h=!1),a.queuedFiles.value=a.queuedFiles.value.concat(t),t.forEach(r=>{a.updateFileStatus(r,"failed")}),i("factory-failed",n,t),c.value--)};u.then(n=>{h===!0?v(new Error("Aborted")):a.isAlive()===!0&&(s.value=s.value.filter(r=>r!==u),O(t,n))}).catch(v)}else O(t,u||{})}function O(t,u){const v=new FormData,n=new XMLHttpRequest,r=(o,b)=>u[o]!==void 0?g(u[o])(b):T.value[o](b),q=r("url",t);if(!q){console.error("q-uploader: invalid or no URL specified"),c.value--;return}const R=r("formFields",t);R!==void 0&&R.forEach(o=>{v.append(o.name,o.value)});let L=0,d=0,P=0,y=0,M;n.upload.addEventListener("progress",o=>{if(M===!0)return;const b=Math.min(y,o.loaded);a.uploadedSize.value+=b-P,P=b;let x=P-d;for(let z=L;x>0&&z<t.length;z++){const m=t[z];if(x>m.size)x-=m.size,L++,d+=m.size,a.updateFileStatus(m,"uploading",m.size);else{a.updateFileStatus(m,"uploading",x);return}}},!1),n.onreadystatechange=()=>{n.readyState<4||(n.status&&n.status<400?(a.uploadedFiles.value=a.uploadedFiles.value.concat(t),t.forEach(o=>{a.updateFileStatus(o,"uploaded")}),i("uploaded",{files:t,xhr:n})):(M=!0,a.uploadedSize.value-=P,a.queuedFiles.value=a.queuedFiles.value.concat(t),t.forEach(o=>{a.updateFileStatus(o,"failed")}),i("failed",{files:t,xhr:n})),c.value--,p.value=p.value.filter(o=>o!==n))},n.open(r("method",t),q),r("withCredentials",t)===!0&&(n.withCredentials=!0);const E=r("headers",t);E!==void 0&&E.forEach(o=>{n.setRequestHeader(o.name,o.value)});const k=r("sendRaw",t);t.forEach(o=>{a.updateFileStatus(o,"uploading",0),k!==!0&&v.append(r("fieldName",o),o,o.name),o.xhr=n,o.__abort=()=>{n.abort()},y+=o.size}),i("uploading",{files:t,xhr:n}),p.value.push(n),k===!0?n.send(new Blob(t)):n.send(v)}return{isUploading:f,isBusy:S,abort:B,upload:D}}var Re={name:"QUploader",props:Ae,emits:Ue,injectPlugin:He},We=ze(Re);export{Ie as Q,We as a};
